{
  if (collection == null) {
    return "null";
  }
  boolean first=true;
  StringBuilder argBuf=new StringBuilder(collection.length);
  argBuf.append('[');
  for (  Object item : collection) {
    if (first) {
      first=false;
    }
 else {
      argBuf.append(", ");
    }
    if (maxSize != -1 && argBuf.length() > maxSize) {
      argBuf.append("...");
      break;
    }
    if (item == collection) {
      argBuf.append("(this Collection)");
    }
 else {
      String str;
      try {
        str=format(item,verbose,sizeLeft(maxSize,argBuf));
      }
 catch (      Exception ex) {
        if (!safe)         throw new GroovyRuntimeException(ex);
        String hash;
        try {
          hash=Integer.toHexString(item.hashCode());
        }
 catch (        Exception ignored) {
          hash="????";
        }
        str="<" + item.getClass().getName() + "@"+ hash+ ">";
      }
      argBuf.append(str);
    }
  }
  argBuf.append(']');
  return argBuf.toString();
}
